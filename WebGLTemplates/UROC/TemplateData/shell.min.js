"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};const reelsoft_number_to_normal_number=number=>{return(number/100).toFixed(2)};const my_template_config={asset_domain:"https://ik.imagekit.io/bmp6bnlpn",cache_bust_params:Date.now().toString()};class GameShell{static update_rtp(value){return __awaiter(this,void 0,void 0,function*(){this.rtp=value;document.querySelector(".bind.rtp").innerText=`${this.rtp}%`})}static toggle(t){const parent=t.parentNode;const callback_name=parent.dataset.callback;if(callback_name&&typeof GameShell[callback_name]==="function"){GameShell[callback_name]()}}static toggle_sounds(input_element){var _a;const sound_on=(_a=input_element.checked)!==null&&_a!==void 0?_a:false;GameShell.send_message_to_unity("mute",{state:sound_on})}static collapse_quick_actions(){document.querySelector("#toggle_menu input[type=checkbox]").checked=false}static get_dialog_by_id(id_selector){return document.querySelector(`dialog#${id_selector}.uroc-modal`)}static show_dialog_by_id(id_selector){const dialog=GameShell.get_dialog_by_id(id_selector);dialog.addEventListener("click",GameShell.handle_backdrop_click);dialog.showModal();GameShell.collapse_quick_actions()}static close_dialog_by_id(id_selector){const dialog=GameShell.get_dialog_by_id(id_selector);dialog.removeEventListener("click",GameShell.handle_backdrop_click);dialog.close()}static get_unity_canvas(){return document.querySelector("#unity-canvas")}static is_fullscreen(){return document.querySelector("#full_screen_status").checked}static toggle_fullscreen_native(){if(document.fullscreenElement===null){const element=document.documentElement;if(element.requestFullscreen){element.requestFullscreen()}else{GameShell.toggle_fullscreen_with_unity()}}else{if(document.exitFullscreen){document.exitFullscreen();document.querySelector("#full_screen_status").checked=false}else{GameShell.toggle_fullscreen_with_unity()}}}static toggle_fullscreen_with_unity(){if(!GameShell.unityInstance){console.log("No unity instance to toggle fullscreen on.");return}if(!GameShell.is_fullscreen()){GameShell.unityInstance.SetFullscreen(1)}else{GameShell.unityInstance.SetFullscreen(0)}}static quit_confirm(){try{GameShell.unityInstance.Quit().then(()=>{document.querySelector("#unity-container").remove();canvas=null;script.remove();script=null;document.location.href="https://www.uroc.com"})}catch(ex){console.log(ex)}}static get_language_modal_flag(){return GameShell.get_dialog_by_id("language_modal").querySelector("img.flag")}static get_language_modal_label(){return GameShell.get_dialog_by_id("language_modal").querySelector("label")}static get_requested_language(){return GameShell.get_language_modal_flag().getAttribute("src").split("/").pop().split(".").shift()}static previous_language(){const current_index=GameShell.available_languages.findIndex(i=>i.code===GameShell.get_requested_language());const index_to_use=(current_index-1+GameShell.available_languages.length)%GameShell.available_languages.length;const language_to_use=GameShell.available_languages[index_to_use].code;GameShell.get_language_modal_label().innerText=GameShell.available_languages[index_to_use].label;GameShell.update_flag_image_elements(language_to_use)}static next_language(){const current_index=GameShell.available_languages.findIndex(i=>i.code===GameShell.get_requested_language());const index_to_use=(current_index+1)%GameShell.available_languages.length;const language_to_use=GameShell.available_languages[index_to_use].code;GameShell.get_language_modal_label().innerText=GameShell.available_languages[index_to_use].label;GameShell.update_flag_image_elements(language_to_use)}static update_flag_image_elements(language_code){document.querySelectorAll("img.flag").forEach(i=>{i.src=`${my_template_config.asset_domain}/flags/${language_code}.svg`})}static update_language(){const requested_language=GameShell.get_requested_language();if(requested_language===GameShell.current_language){GameShell.close_language_modal(true);return}GameShell.current_language=requested_language;GameShell.close_language_modal();GameShell.send_message_to_unity("setLanguage",{language:requested_language,isSocial:false})}static close_language_modal(force=false){if(force){const index_to_use=GameShell.available_languages.findIndex(i=>i.code===GameShell.current_language);const language_to_use=GameShell.available_languages[index_to_use].code;GameShell.get_language_modal_label().innerText=GameShell.available_languages[index_to_use].label;GameShell.update_flag_image_elements(language_to_use)}GameShell.get_dialog_by_id("language_modal").close()}static show_error_popup(){return __awaiter(this,arguments,void 0,function*(error_text=""){const error_modal=GameShell.get_dialog_by_id("error_modal");error_modal.oncancel=event=>{event.preventDefault();event.stopPropagation();GameShell.reload()};if(error_text){error_modal.querySelector("p").innerText=error_text}error_modal.showModal();GameShell.collapse_quick_actions()})}static reload(){document.location.reload()}static populate_bet_levels(){const container=GameShell.get_dialog_by_id("bet_levels_modal").querySelector(".grid");container.innerHTML="";GameShell.bet_levels.forEach(bet_level=>{const clickable=document.createElement("label");clickable.textContent=GameShell.currency_prefix+` ${bet_level.with_decimals}`;const input=document.createElement("input");input.type="radio";input.name="amounts";input.value=bet_level.with_decimals;input.checked=GameShell.current_bet===bet_level.with_decimals;input.onchange=()=>{GameShell.set_bet(bet_level.with_decimals)};clickable.appendChild(input);container.appendChild(clickable)})}static set_bet(value_with_decimals){return __awaiter(this,void 0,void 0,function*(){var _a;if(value_with_decimals===GameShell.current_bet){return}const raw_value=(_a=GameShell.bet_levels.find(i=>i.with_decimals===value_with_decimals))===null||_a===void 0?void 0:_a.raw;GameShell.current_bet=value_with_decimals;GameShell.format_pay_tables().then(GameShell.populate_pay_tables);GameShell.send_message_to_unity("setBet",{value:raw_value});const existing_bet_level_radio=GameShell.get_dialog_by_id("bet_levels_modal").querySelector(`input[type=radio][value="${value_with_decimals}"]`);if(!existing_bet_level_radio){return}existing_bet_level_radio.checked=true})}static get_pay_tables_grid(){return document.querySelector(".grid.paytable")}static format_pay_tables(){return __awaiter(this,void 0,void 0,function*(){if(GameShell.open_game_data===undefined||GameShell.open_game_data.payTable===undefined){GameShell.pay_tables=[];return Promise.resolve(GameShell.pay_tables)}const symbol_map=["WC","AA","BB","CC","DD","EE","FF","GG","HH","JJ","C01","C02","C03","C04","C05","C30"];const result=[];GameShell.open_game_data.payTable.forEach(item=>{var _a;if(item.payout===0){return}const payout_factor_based_on_bet=parseFloat(GameShell.current_bet)/parseFloat(GameShell.default_bet);const multiplier_data={count:item.count,base_payout:item.payout,payout_for_bet_amount:(item.payout*parseFloat(GameShell.current_bet)).toFixed(2)};const existing_group_index=result.findIndex(i=>i.symbol_number===item.symbol);if(existing_group_index!==-1){result[existing_group_index].multipliers.push(multiplier_data)}else{const new_group={symbol_number:item.symbol,symbol_code:(_a=symbol_map[item.symbol])!==null&&_a!==void 0?_a:"unknown",multipliers:[multiplier_data]};result.push(new_group)}});result.map(i=>{i.multipliers=i.multipliers.reverse();return i});GameShell.pay_tables=result;return Promise.resolve(GameShell.pay_tables)})}static populate_pay_tables(){const grid=GameShell.get_pay_tables_grid();grid.innerHTML="";GameShell.pay_tables.forEach(pay_table=>{const item=document.createElement("div");item.className="item";const symbol_container=document.createElement("div");symbol_container.className="symbol_container";symbol_container.innerHTML=`<img class="symbol" src="${my_template_config.asset_domain}/games/miami_blaze/symbols/symbol-${pay_table.symbol_code}.webp" alt="symbol ${pay_table.symbol_code} image" />`;const data_container=document.createElement("div");data_container.className="data";pay_table.multipliers.forEach(row=>{data_container.innerHTML+=`
                     <div class="row">
                         <div class="count">x${row.count}</div>
                         <div class="multiplier">${row.payout_for_bet_amount}</div>
                     </div>
                 `});item.appendChild(symbol_container);item.appendChild(data_container);grid.appendChild(item)})}static send_message_to_unity(command,payload={}){if(!GameShell.unityInstance){return}const message=JSON.stringify({command:command,payload:payload});try{GameShell.unityInstance.SendMessage("GameBridge","Pass",message)}catch(ex){console.warn(ex)}}static set_currency_symbol(currency){return __awaiter(this,void 0,void 0,function*(){try{GameShell.currency_prefix=JSON.parse('"'+currency.prefix+'"')}catch(e){console.warn("Failed to decode Unicode escape in currency prefix. Using raw prefix.",currency.prefix,e);GameShell.currency_prefix=""}})}static update_progress_loader(){const circle_progress_element=document.querySelector("#splash svg circle");if(!circle_progress_element){return}const average_progress=(GameShell.splash_progress+GameShell.unity_progress)/2;const start_size=parseInt(window.getComputedStyle(circle_progress_element).strokeDasharray);circle_progress_element.style.strokeDashoffset=start_size-start_size*average_progress+"px"}static on_splash_video_end(){return __awaiter(this,void 0,void 0,function*(){yield GameShell.delay(1e3);GameShell.splash_progress=1})}static on_splash_video_progress(element){return __awaiter(this,void 0,void 0,function*(){const currentTime=element.currentTime;const duration=element.duration;GameShell.splash_progress=currentTime/duration;GameShell.update_progress_loader()})}static handle_escape_key(event){return __awaiter(this,void 0,void 0,function*(){if(event.key!=="Escape"&&event.code!=="Escape"&&event.keyCode!==27){return}event.preventDefault();event.stopPropagation()})}static handle_backdrop_click(event){return __awaiter(this,void 0,void 0,function*(){const dialog=event.target;if(event.target!==dialog){console.log("Backdrop clicked, but dialog dismissal prevented.")}})}static delay(milliseconds){return __awaiter(this,void 0,void 0,function*(){return new Promise(resolve=>setTimeout(resolve,milliseconds))})}static player_enters_game(){return __awaiter(this,void 0,void 0,function*(){document.querySelector("#quick-actions").classList.add("active");const custom_event=new CustomEvent("player_enters_game",{bubbles:false,cancelable:false});window.dispatchEvent(custom_event);GameShell.get_unity_canvas().removeEventListener("pointerdown",GameShell.player_enters_game)})}static init(unityInstance){return __awaiter(this,void 0,void 0,function*(){var _a;GameShell.get_unity_canvas().addEventListener("pointerdown",GameShell.player_enters_game);GameShell.unity_progress=1;while(GameShell.splash_progress!==1){yield GameShell.delay(200)}(_a=document.querySelector("#splash"))===null||_a===void 0?void 0:_a.classList.add("fade-out");setTimeout(()=>{var _a;(_a=document.querySelector("#splash"))===null||_a===void 0?void 0:_a.remove()},800);GameShell.unityInstance=unityInstance;const diagnostics_icon=document.getElementById("diagnostics-icon");if(diagnostics_icon&&unityDiagnostics!==undefined){diagnostics_icon.onclick=()=>{unityDiagnostics.openDiagnosticsDiv(unityInstance.GetMetricsInfo)}}document.querySelectorAll("label.toggle input[type=checkbox]").forEach(i=>{i.addEventListener("change",()=>GameShell.toggle(i))});document.addEventListener("fullscreenchange",event=>{console.log("event",event)})})}}GameShell.rtp=100;GameShell.current_language="en";GameShell.currency_prefix="";GameShell.default_bet="0.00";GameShell.current_bet="0.00";GameShell.bet_levels=[];GameShell.pay_tables=[];GameShell.asset_url="";GameShell.splash_progress=0;GameShell.unity_progress=0;GameShell.is_spinning=false;GameShell.available_languages=[{code:"en",label:"ENGLISH"},{code:"es",label:"ESPAÑOL"},{code:"fe",label:"FRANÇAIS"},{code:"pt",label:"PORTUGUÊS"},{code:"cn",label:"中国人"}];window.addEventListener("bet_changed",bet_changed_event=>{GameShell.set_bet(reelsoft_number_to_normal_number(bet_changed_event.detail.amount))});window.addEventListener("time_out",()=>GameShell.show_error_popup("Your session has timed out"));window.addEventListener("game_is_spinning",()=>{GameShell.is_spinning=true;document.querySelectorAll("button.disable_on_spin").forEach(button=>__awaiter(void 0,void 0,void 0,function*(){button.disabled=true}))});window.addEventListener("game_is_not_spinning",()=>{GameShell.is_spinning=false;document.querySelectorAll("button.disable_on_spin").forEach(button=>__awaiter(void 0,void 0,void 0,function*(){button.disabled=false}))});window.addEventListener("change_bet_amount",()=>GameShell.show_dialog_by_id("bet_levels_modal"));window.addEventListener("open_game_data",open_game_data=>{GameShell.open_game_data=open_game_data.detail;GameShell.current_bet=reelsoft_number_to_normal_number(GameShell.open_game_data.defaultBet);GameShell.default_bet=reelsoft_number_to_normal_number(GameShell.open_game_data.defaultBet);GameShell.bet_levels=GameShell.open_game_data.betLevels.map(i=>{return{with_decimals:reelsoft_number_to_normal_number(i),raw:i}});GameShell.set_currency_symbol(GameShell.open_game_data.currency).then(GameShell.populate_bet_levels);GameShell.format_pay_tables().then(GameShell.populate_pay_tables);GameShell.update_rtp(GameShell.open_game_data.rtpVersion)});document.addEventListener("keydown",GameShell.handle_escape_key,true);